{% extends "base.html" %}
{% block title %}Joburi{% endblock %}
{% block content %}
<section class="container">
  <h1>Joburi</h1>

  <!-- Filter panel -->
  <form method="get" action="" class="filters" id="filters" role="search" aria-label="Filtre joburi">
    <div class="grid">
      <input type="text" name="q" placeholder="Rol sau skill" value="{{ query.q }}" />
      <input type="text" name="loc" placeholder="Locație" value="{{ query.loc }}" />
      <select name="employment_type">
        <option value="">Tip angajare</option>
        {% for val,label in employment_type_choices %}
          <option value="{{ val }}" {% if query.employment_type == val|stringformat:"s" %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <select name="work_type">
        <option value="">Tip lucru</option>
        {% for val,label in work_type_choices %}
          <option value="{{ val }}" {% if query.work_type == val|stringformat:"s" %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <label class="checkbox">
        <input type="checkbox" name="has_salary" value="1" {% if query.has_salary %}checked{% endif %}> Are salariu
      </label>
      <select name="sort">
        <option value="new" {% if not query.sort or query.sort == "new" %}selected{% endif %}>Cel mai nou</option>
        <option value="salary" {% if query.sort == "salary" %}selected{% endif %}>Salariu</option>
      </select>
      <button class="btn btn-primary" type="submit">Aplică filtre</button>
    </div>
  </form>

  <!-- Active filter chips -->
  {% if active_filters %}
    <div class="chips" aria-label="Filtre active">
      {% for key, val in active_filters.items %}
        <a class="chip" href="{{ remove_links.key|default:remove_links[key] }}">
          {% if key == 'q' %}Căutare: {{ val }}{% elif key == 'loc' %}Locație: {{ val }}{% elif key == 'employment_type' %}Angajare: {{ val }}{% elif key == 'work_type' %}Lucru: {{ val }}{% elif key == 'has_salary' %}Are salariu{% elif key == 'sort' %}Sortare: {{ val }}{% else %}{{ key }}: {{ val }}{% endif %}
          <span class="x">×</span>
        </a>
      {% endfor %}
      <a class="chip clear" href="?">Resetează</a>
    </div>
  {% endif %}

  <!-- Cards list -->
  {% if jobs %}
    <ul class="list cards" role="list">
      {% for job in jobs %}
        {% include "jobs/_job_card.html" with job=job %}
      {% endfor %}
    </ul>

    <!-- Pagination with filter persistence -->
    {% if is_paginated %}
      <nav class="pagination" aria-label="Paginare">
        <ul>
          {% if page_obj.has_previous %}
            <li><a href="?{{ querystring }}&page={{ page_obj.previous_page_number }}">Înapoi</a></li>
          {% endif %}
          <li>Pagina {{ page_obj.number }} din {{ page_obj.paginator.num_pages }}</li>
          {% if page_obj.has_next %}
            <li><a href="?{{ querystring }}&page={{ page_obj.next_page_number }}">Înainte</a></li>
          {% endif %}
        </ul>
      </nav>
    {% endif %}
  {% else %}
    <p>Nu s-au găsit joburi pentru filtrele curente.</p>
  {% endif %}
</section>

<!-- Quick Apply Modal -->
<div id="quickApplyModal" class="modal" aria-hidden="true" role="dialog" aria-label="Aplică rapid" style="display:none;">
  <div class="modal-dialog">
    <div class="modal-header">
      <h3 id="qa-title">Aplică rapid</h3>
      <button type="button" class="modal-close" data-action="modal-close" aria-label="Închide">×</button>
    </div>
    <div class="modal-body">
      <p>Vei aplica pentru: <strong id="qa-job-title"></strong></p>
    </div>
    <div class="modal-footer">
      <a id="qa-apply-link" class="btn btn-primary" href="#">Continuă</a>
    </div>
  </div>
</div>

<!-- State element for Quick Apply readiness -->
<div id="qa-state" data-qar="{{ quick_apply_ready|yesno:'1,0' }}"></div>

<!-- Onboarding overlay for first-time Quick Apply -->
<div id="qa-onboarding" class="modal" aria-hidden="true" role="dialog" aria-label="Completare rapidă" style="display:none;" data-endpoint="{% url 'accounts:quick_apply_prep' %}">
  <div class="modal-dialog">
    <div class="modal-header">
      <h3>Înainte să aplici</h3>
      <button type="button" class="modal-close" data-action="modal-close" aria-label="Închide">×</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Locație</label>
        <input type="text" id="qa-loc" class="input" placeholder="ex: București">
      </div>
      <div class="form-group">
        <label>Aptitudini principale (max 3, separate prin virgule)</label>
        <input type="text" id="qa-skills" class="input" placeholder="ex: React, Python, SQL">
      </div>
      <p class="muted">CV și Scrisoare de intenție sunt opționale.</p>
    </div>
    <div class="modal-footer">
      <button id="qa-save-continue" class="btn btn-primary" type="button">Salvează și continuă</button>
    </div>
  </div>
</div>
{% endblock %}