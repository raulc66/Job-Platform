{% extends 'base.html' %}
{% block title %}{{ job.title }}{% endblock %}

{% block content %}
<h1>{{ job.title }}</h1>
<p class="text-muted">
  {% if job.company %}{{ job.company.name }} • {% endif %}
  {% if job.location %}{{ job.location }}{% endif %}
  {% if job.get_employment_type_display %} • {{ job.get_employment_type_display }}{% endif %}
</p>
<div class="mt-3">{{ job.description|linebreaks }}</div>

<!-- Similar jobs -->
{% include "jobs/_similar_jobs.html" with jobs=similar_jobs %}

<!-- Quick Apply modal (shared with A3 behavior) -->
<div id="quickApplyModal" class="modal" aria-hidden="true" role="dialog" aria-label="Aplică rapid" style="display:none;">
  <div class="modal-dialog">
    <div class="modal-header">
      <h3 id="qa-title">Aplică rapid</h3>
      <button type="button" class="modal-close" data-action="modal-close" aria-label="Închide">×</button>
    </div>
    <div class="modal-body">
      <p>Vei aplica pentru: <strong id="qa-job-title"></strong></p>
      <p class="muted">CV (opțional) și Scrisoare de intenție (opțional) pot fi adăugate ulterior.</p>
    </div>
    <div class="modal-footer">
      <a id="qa-apply-link" class="btn btn-primary" href="#">Continuă</a>
    </div>
  </div>
</div>

<!-- Spacer so the sticky bar doesn't overlap content on mobile -->
<div class="sticky-apply-spacer" aria-hidden="true"></div>

<!-- Sticky apply bar (mobile) -->
{% if request.user.is_authenticated and request.user.role == 'seeker' %}
<nav class="sticky-apply" aria-label="Acțiuni job">
  <div class="sticky-apply-title" title="{{ job.title }}">{{ job.title }}</div>
  <button class="btn btn-primary" data-action="quick-apply" data-slug="{{ job.slug }}" data-title="{{ job.title }}">
    Aplică acum
  </button>
</nav>
{% else %}
<nav class="sticky-apply" aria-label="Acțiuni job">
  <div class="sticky-apply-title" title="{{ job.title }}">{{ job.title }}</div>
  <a class="btn btn-primary" href="{% url 'applications:apply' slug=job.slug %}">Aplică acum</a>
</nav>
{% endif %}
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "JobPosting",
    "title": "{{ job.title|escapejs }}",
    {% if job.company %}"hiringOrganization": {"@type": "Organization", "name": "{{ job.company.name|escapejs }}"},{% endif %}
    {% if job.created_at %}"datePosted": "{{ job.created_at|date:'c' }}",{% endif %}
    {% if job.location %}"jobLocation": {"@type": "Place", "address": {"@type": "PostalAddress", "addressLocality": "{{ job.location|escapejs }}""}},{% endif %}
    {% if job.employment_type %}"employmentType": "{{ job.employment_type|escapejs }}",{% endif %}
    {% if job.valid_through %}"validThrough": "{{ job.valid_through|date:'c' }}",{% endif %}
    "description": "{{ job.description|striptags|truncatechars:300|escapejs }}"
  }
  </script>
{% endblock %}
