{% extends 'base.html' %}
{% block title %}{{ job.title }}{% endblock %}
{% block meta_description %}{{ job.title }} la {% if job.company %}{{ job.company.name }}{% endif %}{% if job.location %}, {{ job.location }}{% endif %}.{% endblock %}

{% block content %}
<section class="container container--narrow">
  <div class="hero">
    <h1 class="title">{{ job.title }}</h1>
    <p class="muted">{{ job.company.name }} • {{ job.get_city_display }}</p>
    <div class="pills">
      <span class="pill">{{ job.get_category_display }}</span>
      {% if job.salary_min %}<span class="pill">RON {{ job.salary_min }}{% if job.salary_max %}–{{ job.salary_max }}{% endif %}</span>{% endif %}
      {% if job.expires_at %}<span class="pill">Expires {{ job.expires_at|date:"M j, Y" }}</span>{% endif %}
    </div>
    <div class="hero__cta">
      {% if request.user.is_authenticated and request.user.role == 'seeker' %}
        {% if job %}
          <a class="btn btn-primary" href="{% url 'applications:apply' slug=job.slug %}">Aplică acum</a>
        {% elif object %}
          <a class="btn btn-primary" href="{% url 'applications:apply' slug=object.slug %}">Aplică acum</a>
        {% endif %}
      {% else %}
        <a class="btn btn--sub" href="{% url 'accounts:login' %}">Login to Apply</a>
      {% endif %}
      {% if request.user.is_authenticated and request.user.role == 'employer' and request.user == job.company.owner %}
        <a class="btn" href="{% url 'jobs:create' %}">Post another job</a>
      {% endif %}
    </div>
  </div>

  <article class="prose">
    {{ job.description|linebreaks }}
  </article>
</section>
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org/",
    "@type": "JobPosting",
    "title": "{{ job.title|escapejs }}",
    {% if job.company %}"hiringOrganization": {"@type": "Organization", "name": "{{ job.company.name|escapejs }}"},{% endif %}
    {% if job.created_at %}"datePosted": "{{ job.created_at|date:'c' }}",{% endif %}
    {% if job.location %}"jobLocation": {"@type": "Place", "address": {"@type": "PostalAddress", "addressLocality": "{{ job.location|escapejs }}""}},{% endif %}
    {% if job.employment_type %}"employmentType": "{{ job.employment_type|escapejs }}",{% endif %}
    {% if job.valid_through %}"validThrough": "{{ job.valid_through|date:'c' }}",{% endif %}
    "description": "{{ job.description|striptags|truncatechars:300|escapejs }}"
  }
  </script>
{% endblock %}
